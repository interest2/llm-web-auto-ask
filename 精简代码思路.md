# ä¸»ç›®å½•ã€å‰¯ç›®å½•åŠŸèƒ½ä»£ç ç²¾ç®€æ€è·¯

## âš ï¸ é‡è¦è¯´æ˜ï¼šçœŸæ­£çš„ä»£ç ç²¾ç®€

**æ‹†åˆ†æ–¹æ³• â‰  å‡å°‘ä»£ç é‡**ã€‚æ‹†åˆ†åªæ˜¯è®©ä»£ç æ›´æ˜“è¯»ï¼Œä½†æ€»è¡Œæ•°å¯èƒ½å¢åŠ ï¼ˆå› ä¸ºéœ€è¦å‡½æ•°å®šä¹‰ã€å‚æ•°ä¼ é€’ç­‰ï¼‰ã€‚

**çœŸæ­£çš„ç²¾ç®€åº”è¯¥æ˜¯**ï¼š
1. æ¶ˆé™¤é‡å¤ä»£ç 
2. åˆå¹¶ç›¸ä¼¼é€»è¾‘
3. æå–å…¬å…±å·¥å…·å‡½æ•°
4. ç®€åŒ–å¤æ‚æ¡ä»¶åˆ¤æ–­
5. å‡å°‘ä¸å¿…è¦çš„ä¸­é—´å˜é‡

---

## ä¸€ã€éœ€è¦ç²¾ç®€çš„é•¿æ–¹æ³•åˆ—è¡¨

### 1. `showSubNavBar` æ–¹æ³•ï¼ˆ1927-2171è¡Œï¼Œçº¦244è¡Œï¼‰â­ æœ€ä¼˜å…ˆ
**é—®é¢˜**ï¼šæ–¹æ³•è¿‡é•¿ï¼ŒåŒ…å«å¤šä¸ªèŒè´£
**èŒè´£åˆ†è§£**ï¼š
- éªŒè¯å’Œè½®è¯¢ä¼˜åŒ–é€»è¾‘ï¼ˆ1928-1966è¡Œï¼Œçº¦38è¡Œï¼‰
- å±‚çº§è®¡ç®—é€»è¾‘ï¼ˆ1971-1998è¡Œï¼Œçº¦27è¡Œï¼‰
- åˆ›å»ºæ ‡é¢˜å®¹å™¨å’Œå±‚çº§æŒ‰é’®ï¼ˆ2000-2075è¡Œï¼Œçº¦75è¡Œï¼‰
- åˆ›å»ºä½ç½®æŒ‰é’®ï¼ˆ2077-2125è¡Œï¼Œçº¦48è¡Œï¼‰
- åˆ›å»ºå…³é—­æŒ‰é’®ï¼ˆ2127-2152è¡Œï¼Œçº¦25è¡Œï¼‰
- æœ€ç»ˆæ¸²æŸ“å’Œæ˜¾ç¤ºï¼ˆ2154-2170è¡Œï¼Œçº¦16è¡Œï¼‰

### 2. `createNavLink` æ–¹æ³•ï¼ˆ2274-2440è¡Œï¼Œçº¦166è¡Œï¼‰â­ é«˜ä¼˜å…ˆçº§
**é—®é¢˜**ï¼šæ–¹æ³•è¿‡é•¿ï¼Œäº‹ä»¶å¤„ç†é€»è¾‘å¤æ‚
**èŒè´£åˆ†è§£**ï¼š
- åˆ›å»ºå‰¯ç›®å½•å›¾æ ‡ï¼ˆ2279-2331è¡Œï¼Œçº¦52è¡Œï¼‰
- åˆ›å»ºé“¾æ¥å†…å®¹ï¼ˆ2333-2345è¡Œï¼Œçº¦12è¡Œï¼‰
- é“¾æ¥ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼ˆ2350-2434è¡Œï¼Œçº¦84è¡Œï¼‰
  - å…ƒç´ éªŒè¯å’Œé‡è¯•é€»è¾‘ï¼ˆ2352-2432è¡Œï¼‰

### 3. `renderSubNavItems` æ–¹æ³•ï¼ˆ1832-1918è¡Œï¼Œçº¦86è¡Œï¼‰
**é—®é¢˜**ï¼šæ ‡é¢˜é¡¹åˆ›å»ºé€»è¾‘å¯ä»¥æå–
**èŒè´£åˆ†è§£**ï¼š
- è¿‡æ»¤æ ‡é¢˜ï¼ˆ1832-1842è¡Œï¼‰
- åˆ›å»ºå•ä¸ªæ ‡é¢˜é¡¹ï¼ˆ1853-1917è¡Œï¼Œçº¦64è¡Œï¼‰

### 4. `findHeadingsInContent` æ–¹æ³•ï¼ˆ1713-1782è¡Œï¼Œçº¦69è¡Œï¼‰
**é—®é¢˜**ï¼šé€»è¾‘æ¸…æ™°ä½†å¯ä»¥ä¼˜åŒ–
**ä¼˜åŒ–ç‚¹**ï¼š
- æå–å»é‡å’Œæ’åºé€»è¾‘ä¸ºç‹¬ç«‹æ–¹æ³•

### 5. `findMarkdownHeadings` æ–¹æ³•ï¼ˆ1639-1710è¡Œï¼Œçº¦71è¡Œï¼‰
**é—®é¢˜**ï¼šé€»è¾‘ç›¸å¯¹ç‹¬ç«‹ï¼Œå¯ä»¥ä¿æŒç°çŠ¶æˆ–å°å¹…ä¼˜åŒ–

---

## äºŒã€çœŸæ­£çš„ç²¾ç®€æ–¹æ¡ˆï¼ˆå‡å°‘ä»£ç é‡ï¼‰

### æ–¹æ¡ˆ1ï¼š`showSubNavBar` æ–¹æ³• - çœŸæ­£å‡å°‘ä»£ç 

#### å‘ç°çš„å¯ä¼˜åŒ–ç‚¹ï¼š

1. **é‡å¤çš„æ‚¬åœæ•ˆæœä»£ç **ï¼ˆå¯å‡å°‘çº¦12è¡Œï¼‰
   - positionBtn å’Œ closeBtn çš„ mouseenter/mouseleave å®Œå…¨ç›¸åŒï¼ˆ2081-2086è¡Œ å’Œ 2131-2136è¡Œï¼‰
   - å¯ä»¥æå–ä¸ºå·¥å…·å‡½æ•°

2. **å¯ä»¥åˆå¹¶çš„éªŒè¯é€»è¾‘**ï¼ˆå¯å‡å°‘çº¦5è¡Œï¼‰
   - 1928-1941è¡Œçš„å¤šä¸ª if return å¯ä»¥åˆå¹¶

3. **å¯ä»¥ç®€åŒ–çš„å±‚çº§è®¡ç®—**ï¼ˆå¯å‡å°‘çº¦8è¡Œï¼‰
   - 1974-1998è¡Œçš„å±‚çº§è®¡ç®—é€»è¾‘å¯ä»¥ç®€åŒ–

4. **å¯ä»¥æå–çš„æŒ‰é’®åˆ›å»ºæ¨¡å¼**ï¼ˆå¯å‡å°‘çº¦10è¡Œï¼‰
   - ä½ç½®æŒ‰é’®å’Œå…³é—­æŒ‰é’®çš„åˆ›å»ºæ¨¡å¼ç›¸ä¼¼

#### ç²¾ç®€åçš„ä»£ç ï¼ˆå‡å°‘çº¦35è¡Œï¼‰ï¼š

```javascript
// æå–å·¥å…·å‡½æ•°ï¼šæ·»åŠ ç®€å•çš„æ‚¬åœæ•ˆæœ
const addSimpleHover = (element, hoverBg = '#f0f0f0', normalBg = 'transparent') => {
    element.addEventListener('mouseenter', () => element.style.backgroundColor = hoverBg);
    element.addEventListener('mouseleave', () => element.style.backgroundColor = normalBg);
};

// åˆå¹¶éªŒè¯é€»è¾‘
const shouldShowSubNav = (headings, isPolling) => {
    if (isSubNavClosed() || !headings?.length || headings.length <= SUB_NAV_MIN_ITEMS) {
        return false;
    }
    // è½®è¯¢ä¼˜åŒ–é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
    if (isPolling && currentSubNavHeadings.length > 0) {
        if (headings.length < currentSubNavHeadings.length) {
            console.log(`è½®è¯¢æ—¶æ ‡é¢˜æ•°é‡å‡å°‘ï¼Œä¿ç•™ç°æœ‰æ ‡é¢˜`);
            return false;
        }
        if (headings.length === currentSubNavHeadings.length) {
            const existingKeys = new Set(currentSubNavHeadings.map(h => 
                `${h.text}_${h.level}_${Math.floor(h.position / 5)}`));
            const newKeys = new Set(headings.map(h => 
                `${h.text}_${h.level}_${Math.floor(h.position / 5)}`));
            if (existingKeys.size === newKeys.size && 
                [...existingKeys].every(k => newKeys.has(k))) {
                return false;
            }
        }
    }
    return true;
};

// ç®€åŒ–å±‚çº§è®¡ç®—
const updateSubNavLevel = (questionIndex, headings, existingLevels) => {
    const isSameQuestion = questionIndex === currentSubNavQuestionIndex;
    if (isSameQuestion && isSubNavLevelManuallySet) {
        currentSubNavQuestionIndex = questionIndex;
        return;
    }
    currentSubNavQuestionIndex = questionIndex;
    isSubNavLevelManuallySet = false;
    if (existingLevels.length > 0) {
        const highestLevel = existingLevels[0];
        currentSubNavLevel = headings.length > SUB_NAV_PREV_LEVEL_THRESHOLD && 
            existingLevels.includes(highestLevel - 1) 
            ? highestLevel - 1 
            : highestLevel;
    }
};

// åˆ›å»ºä½ç½®æŒ‰é’®ï¼ˆç®€åŒ–ç‰ˆï¼‰
const createPositionButton = (titleContainer) => {
    const btn = createTag('div', 'ä½ç½®', NAV_STYLES.subNavPositionBtn);
    btn.title = 'è®¾ç½®å‰¯ç›®å½•ä½ç½®';
    addSimpleHover(btn);
    btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const input = document.createElement('input');
        Object.assign(input, {
            type: 'text',
            value: getSubNavLeft(),
            style: { cssText: NAV_STYLES.subNavPositionInput }
        });
        btn.style.display = 'none';
        titleContainer.appendChild(input);
        input.focus();
        input.select();
        const handleBlur = () => {
            const newLeft = input.value.trim();
            const formatRegex = /^\d+(\.\d+)?px$/;
            if (newLeft && formatRegex.test(newLeft)) {
                setSubNavLeft(newLeft);
                subNavBar.style.left = newLeft;
            } else if (newLeft) {
                input.value = getSubNavLeft();
                alert('ä½ç½®æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥"æ•°å­—+px"æ ¼å¼ï¼Œä¾‹å¦‚ï¼š270px');
            }
            input.remove();
            btn.style.display = 'flex';
        };
        input.addEventListener('blur', handleBlur);
        input.addEventListener('keydown', (e) => e.key === 'Enter' && input.blur());
    });
    return btn;
};

// åˆ›å»ºå…³é—­æŒ‰é’®ï¼ˆç®€åŒ–ç‰ˆï¼‰
const createCloseButton = () => {
    const btn = createTag('div', 'Ã—', NAV_STYLES.subNavCloseBtn);
    btn.title = 'å…³é—­å‰¯ç›®å½•';
    addSimpleHover(btn);
    btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const firstCloseKey = `${T}subNavFirstCloseShown`;
        if (!GM_getValue(firstCloseKey, false)) {
            alert("è¿™å®¶å¤§æ¨¡å‹å°†ä¸å†æ˜¾ç¤ºå‰¯ç›®å½•ï¼›\nè‹¥éœ€æ¢å¤ï¼Œç‚¹å‡»ä¸»ç›®å½•æ¯æ¡æé—®å‰çš„å°å›¾æ ‡å³å¯");
            GM_setValue(firstCloseKey, true);
        }
        setSubNavClosed(true);
        hideSubNavBar();
    });
    return btn;
};

// ç²¾ç®€åçš„ showSubNavBarï¼ˆä»244è¡Œå‡å°‘åˆ°çº¦60è¡Œï¼‰
const showSubNavBar = (questionIndex, headings, isPolling = false) => {
    if (!shouldShowSubNav(headings, isPolling)) return;
    
    currentSubNavHeadings = headings;
    const existingLevels = [...new Set(headings.map(h => h.level))].sort((a, b) => b - a);
    updateSubNavLevel(questionIndex, headings, existingLevels);
    
    subNavBar.replaceChildren();
    const titleContainer = createTag('div', "", 
        'position:relative;padding-right:24px;padding-bottom:6px;border-bottom:1px solid #eaeaea;margin-bottom:6px;');
    titleContainer.className = 'sub-nav-title-container';
    
    const titleRow = createTag('div', "", 
        'display:flex;align-items:center;justify-content:space-between;gap:8px;');
    const titleLeft = createTag('div', "", 'display:flex;align-items:center;gap:8px;flex:1;');
    const titleText = createTag('span', `å‰¯ç›®å½• ${questionIndex + 1}`, 
        'font-weight:bold;color:#333;font-size:14px;');
    
    const levelBtnGroup = createTag('div', "", NAV_STYLES.levelBtnGroup);
    existingLevels.slice().reverse().forEach(level => {
        const btn = document.createElement('div');
        Object.assign(btn, {
            textContent: `h${level}`,
            dataset: { level },
            style: { cssText: NAV_STYLES.levelBtn + 
                (level === currentSubNavLevel ? NAV_STYLES.levelBtnActive : '') }
        });
        if (level !== currentSubNavLevel) {
            btn.addEventListener('mouseenter', () => 
                btn.style.cssText = NAV_STYLES.levelBtn + NAV_STYLES.levelBtnHover);
            btn.addEventListener('mouseleave', () => 
                btn.style.cssText = NAV_STYLES.levelBtn + NAV_STYLES.levelBtnLeave);
        }
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            currentSubNavLevel = level;
            isSubNavLevelManuallySet = true;
            levelBtnGroup.querySelectorAll('[data-level]').forEach(b => {
                b.style.cssText = NAV_STYLES.levelBtn + 
                    (parseInt(b.dataset.level) === level ? NAV_STYLES.levelBtnActive : '');
            });
            renderSubNavItems();
            updateSubNavTop();
        });
        levelBtnGroup.appendChild(btn);
    });
    
    appendSeveral(titleLeft, titleText, levelBtnGroup);
    titleRow.appendChild(titleLeft);
    titleContainer.appendChild(titleRow);
    appendSeveral(titleContainer, createPositionButton(titleContainer), createCloseButton());
    
    subNavBar.appendChild(titleContainer);
    renderSubNavItems();
    updateSubNavTop();
    subNavBar.style.left = getSubNavLeft();
    subNavBar.style.display = 'block';
    startSubNavObserver(questionIndex);
};
```

**ä»£ç å‡å°‘ç»Ÿè®¡**ï¼š
- åŸæ–¹æ³•ï¼š244è¡Œ
- ç²¾ç®€åä¸»æ–¹æ³•ï¼šçº¦60è¡Œ
- æå–çš„å·¥å…·å‡½æ•°ï¼šçº¦80è¡Œï¼ˆå¯å¤ç”¨ï¼‰
- **å®é™…å‡å°‘**ï¼šçº¦104è¡Œï¼ˆ244 - 60 - 80 = 104ï¼Œä½†å·¥å…·å‡½æ•°å¯å¤ç”¨ï¼Œå®é™…å‡€å‡å°‘çº¦35-40è¡Œï¼‰

---

### æ–¹æ¡ˆ2ï¼š`showSubNavBar` æ–¹æ³•æ‹†åˆ†ï¼ˆä»…æ‹†åˆ†ï¼Œä¸å‡å°‘ä»£ç ï¼‰

#### æå–æ–¹æ³•1ï¼š`validateAndUpdateSubNavHeadings`
```javascript
// éªŒè¯æ ‡é¢˜å¹¶å¤„ç†è½®è¯¢ä¼˜åŒ–
const validateAndUpdateSubNavHeadings = (headings, isPolling) => {
    if (!headings || headings.length === 0) {
        console.log('æœªæ‰¾åˆ°æ ‡é¢˜');
        return false;
    }
    if (headings.length <= SUB_NAV_MIN_ITEMS) {
        return false;
    }
    // è½®è¯¢ä¼˜åŒ–é€»è¾‘...
    return true;
};
```

#### æå–æ–¹æ³•2ï¼š`calculateSubNavLevel`
```javascript
// è®¡ç®—å‰¯ç›®å½•å±‚çº§
const calculateSubNavLevel = (questionIndex, headings, existingLevels) => {
    const isSameQuestion = questionIndex === currentSubNavQuestionIndex;
    if (isSameQuestion && isSubNavLevelManuallySet) {
        currentSubNavQuestionIndex = questionIndex;
        return; // ä¿ç•™ç”¨æˆ·é€‰æ‹©
    }
    // é‡æ–°è®¡ç®—å±‚çº§é€»è¾‘...
};
```

#### æå–æ–¹æ³•3ï¼š`createSubNavTitleContainer`
```javascript
// åˆ›å»ºæ ‡é¢˜å®¹å™¨ï¼ˆåŒ…å«æ ‡é¢˜æ–‡æœ¬ã€å±‚çº§æŒ‰é’®ã€ä½ç½®æŒ‰é’®ã€å…³é—­æŒ‰é’®ï¼‰
const createSubNavTitleContainer = (questionIndex, existingLevels) => {
    const titleContainer = createTag('div', "", '...');
    // åˆ›å»ºæ ‡é¢˜æ–‡æœ¬...
    // åˆ›å»ºå±‚çº§æŒ‰é’®ç»„...
    // åˆ›å»ºä½ç½®æŒ‰é’®...
    // åˆ›å»ºå…³é—­æŒ‰é’®...
    return titleContainer;
};
```

#### æå–æ–¹æ³•4ï¼š`createSubNavLevelButtons`
```javascript
// åˆ›å»ºå±‚çº§æŒ‰é’®ç»„
const createSubNavLevelButtons = (existingLevels) => {
    const levelBtnGroup = createTag('div', "", NAV_STYLES.levelBtnGroup);
    existingLevels.slice().reverse().forEach(level => {
        const btn = createLevelButton(level);
        levelBtnGroup.appendChild(btn);
    });
    return levelBtnGroup;
};
```

#### æå–æ–¹æ³•5ï¼š`createLevelButton`
```javascript
// åˆ›å»ºå•ä¸ªå±‚çº§æŒ‰é’®
const createLevelButton = (level) => {
    const btn = document.createElement('div');
    // è®¾ç½®æŒ‰é’®å±æ€§å’Œæ ·å¼...
    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨...
    return btn;
};
```

#### æå–æ–¹æ³•6ï¼š`createSubNavPositionButton`
```javascript
// åˆ›å»ºä½ç½®æŒ‰é’®
const createSubNavPositionButton = (titleContainer) => {
    const positionBtn = createTag('div', "", NAV_STYLES.subNavPositionBtn);
    // è®¾ç½®æŒ‰é’®å±æ€§å’Œäº‹ä»¶...
    return positionBtn;
};
```

#### æå–æ–¹æ³•7ï¼š`createSubNavCloseButton`
```javascript
// åˆ›å»ºå…³é—­æŒ‰é’®
const createSubNavCloseButton = () => {
    const closeBtn = createTag('div', "", NAV_STYLES.subNavCloseBtn);
    // è®¾ç½®æŒ‰é’®å±æ€§å’Œäº‹ä»¶...
    return closeBtn;
};
```

**ç²¾ç®€åçš„ `showSubNavBar` æ–¹æ³•**ï¼š
```javascript
const showSubNavBar = (questionIndex, headings, isPolling = false) => {
    if (isSubNavClosed() || !validateAndUpdateSubNavHeadings(headings, isPolling)) {
        return;
    }
    
    currentSubNavHeadings = headings;
    const existingLevels = [...new Set(headings.map(h => h.level))].sort((a, b) => b - a);
    
    calculateSubNavLevel(questionIndex, headings, existingLevels);
    
    subNavBar.replaceChildren();
    const titleContainer = createSubNavTitleContainer(questionIndex, existingLevels);
    subNavBar.appendChild(titleContainer);
    
    renderSubNavItems();
    updateSubNavTop();
    subNavBar.style.left = getSubNavLeft();
    subNavBar.style.display = 'block';
    startSubNavObserver(questionIndex);
};
```

---

### æ–¹æ¡ˆ2ï¼š`createNavLink` æ–¹æ³•æ‹†åˆ†

#### æå–æ–¹æ³•1ï¼š`createSubNavIcon`
```javascript
// åˆ›å»ºå‰¯ç›®å½•å›¾æ ‡
const createSubNavIcon = (questionIndex) => {
    const subNavIcon = createTag('span', 'ğŸ“–', NAV_STYLES.waveIcon);
    subNavIcon.title = 'æ˜¾ç¤ºå‰¯ç›®å½•';
    // æ·»åŠ æ‚¬åœæ•ˆæœ...
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶...
    return subNavIcon;
};
```

#### æå–æ–¹æ³•2ï¼š`handleSubNavIconClick`
```javascript
// å¤„ç†å‰¯ç›®å½•å›¾æ ‡ç‚¹å‡»
const handleSubNavIconClick = (e, questionIndex, el) => {
    e.preventDefault();
    e.stopPropagation();
    
    if (currentSubNavQuestionIndex === questionIndex && subNavBar.style.display === 'block') {
        hideSubNavBar();
        return;
    }
    
    // æŸ¥æ‰¾æ ‡é¢˜å¹¶æ˜¾ç¤ºå‰¯ç›®å½•...
};
```

#### æå–æ–¹æ³•3ï¼š`createNavLinkContent`
```javascript
// åˆ›å»ºé“¾æ¥å†…å®¹
const createNavLinkContent = (el, index) => {
    const link = createTag('div', "", NAV_STYLES.link);
    link.className = 'tool-nav-link';
    // åˆ›å»ºç´¢å¼•å’Œæ–‡æœ¬...
    return link;
};
```

#### æå–æ–¹æ³•4ï¼š`handleNavLinkClick`
```javascript
// å¤„ç†é“¾æ¥ç‚¹å‡»äº‹ä»¶
const handleNavLinkClick = (e, el, index, linkContainer) => {
    e.preventDefault();
    // éªŒè¯å…ƒç´ ...
    // æ»šåŠ¨åˆ°ç›®æ ‡...
    // æ›´æ–°é“¾æ¥æ–‡å­—...
    // è‡ªåŠ¨æ˜¾ç¤ºå‰¯ç›®å½•...
};
```

#### æå–æ–¹æ³•5ï¼š`retryScrollToElement`
```javascript
// é‡è¯•æ»šåŠ¨åˆ°å…ƒç´ 
const retryScrollToElement = (index, linkContainer, maxRetries = 10) => {
    let retryCount = 0;
    const retryInterval = 100;
    const retryTimer = setInterval(() => {
        // é‡è¯•é€»è¾‘...
    }, retryInterval);
};
```

**ç²¾ç®€åçš„ `createNavLink` æ–¹æ³•**ï¼š
```javascript
const createNavLink = (el, i) => {
    const linkContainer = createTag('div', "", NAV_STYLES.linkContainer);
    linkContainer.className = 'tool-nav-link-container';
    
    const subNavIcon = createSubNavIcon(i, el);
    const link = createNavLinkContent(el, i);
    
    link.addEventListener('click', (e) => handleNavLinkClick(e, el, i, linkContainer));
    link.addEventListener('mouseenter', () => link.style.backgroundColor = '#f0f0f0');
    link.addEventListener('mouseleave', () => link.style.backgroundColor = '');
    
    appendSeveral(linkContainer, subNavIcon, link);
    return linkContainer;
};
```

---

### æ–¹æ¡ˆ3ï¼š`renderSubNavItems` æ–¹æ³•æ‹†åˆ†

#### æå–æ–¹æ³•1ï¼š`createSubNavItem`
```javascript
// åˆ›å»ºå•ä¸ªå‰¯ç›®å½•é¡¹
const createSubNavItem = (heading, questionIndex) => {
    const item = document.createElement('div');
    item.className = 'sub-nav-item';
    // è®¾ç½®æ ·å¼...
    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨...
    return item;
};
```

#### æå–æ–¹æ³•2ï¼š`handleSubNavItemClick`
```javascript
// å¤„ç†å‰¯ç›®å½•é¡¹ç‚¹å‡»
const handleSubNavItemClick = (e, heading, questionIndex) => {
    e.preventDefault();
    e.stopPropagation();
    
    let targetElement = heading.element;
    // éªŒè¯å’Œé‡æ–°æŸ¥æ‰¾å…ƒç´ ...
    scrollToTargetWithPrevElement(targetElement);
};
```

**ç²¾ç®€åçš„ `renderSubNavItems` æ–¹æ³•**ï¼š
```javascript
const renderSubNavItems = () => {
    const titleContainer = subNavBar.querySelector('.sub-nav-title-container');
    if (!titleContainer) return;
    
    const items = subNavBar.querySelectorAll('.sub-nav-item');
    items.forEach(item => item.remove());
    
    const filteredHeadings = currentSubNavHeadings.filter(h => h.level <= currentSubNavLevel);
    const headingStyleMap = {
        1: NAV_STYLES.subNavItemH1,
        2: NAV_STYLES.subNavItemH2,
        3: NAV_STYLES.subNavItemH3,
        4: NAV_STYLES.subNavItemH4
    };
    
    filteredHeadings.forEach((heading) => {
        const item = createSubNavItem(heading, currentSubNavQuestionIndex, headingStyleMap);
        subNavBar.appendChild(item);
    });
};
```

---

## ä¸‰ã€å…¬å…±ä¼˜åŒ–å»ºè®®

### 1. æå–å¸¸é‡
- å°†é‡å¤çš„æ ·å¼å­—ç¬¦ä¸²æå–ä¸ºå¸¸é‡
- å°†é‡å¤çš„æ•°å­—ï¼ˆå¦‚é‡è¯•æ¬¡æ•°ã€é—´éš”æ—¶é—´ï¼‰æå–ä¸ºå¸¸é‡

### 2. æå–å·¥å…·æ–¹æ³•
- `addHoverEffect(element, hoverStyle, normalStyle)` - ç»Ÿä¸€å¤„ç†æ‚¬åœæ•ˆæœ
- `createButtonWithEvents(text, style, events)` - ç»Ÿä¸€åˆ›å»ºæŒ‰é’®
- `validateElementExists(element, retryFn)` - ç»Ÿä¸€éªŒè¯å…ƒç´ å­˜åœ¨æ€§

### 3. äº‹ä»¶å¤„ç†ä¼˜åŒ–
- å°†äº‹ä»¶å¤„ç†å‡½æ•°æå–ä¸ºç‹¬ç«‹æ–¹æ³•
- ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡

### 4. DOM æ“ä½œä¼˜åŒ–
- æ‰¹é‡ DOM æ“ä½œï¼ˆä½¿ç”¨ DocumentFragmentï¼‰
- å‡å°‘é‡å¤çš„ `querySelector` è°ƒç”¨

---

## å››ã€å®æ–½ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼š`showSubNavBar` å’Œ `createNavLink`ï¼ˆæ–¹æ³•æœ€é•¿ï¼Œå½±å“æœ€å¤§ï¼‰
2. **ä¸­ä¼˜å…ˆçº§**ï¼š`renderSubNavItems`ï¼ˆé€»è¾‘ç›¸å¯¹ç‹¬ç«‹ï¼Œå®¹æ˜“æ‹†åˆ†ï¼‰
3. **ä½ä¼˜å…ˆçº§**ï¼šå…¶ä»–æ–¹æ³•ï¼ˆå¯ä»¥ä¿æŒç°çŠ¶æˆ–å°å¹…ä¼˜åŒ–ï¼‰

---

## äº”ã€é¢„æœŸæ•ˆæœ

- `showSubNavBar`ï¼šä» 244 è¡Œå‡å°‘åˆ°çº¦ 20-30 è¡Œ
- `createNavLink`ï¼šä» 166 è¡Œå‡å°‘åˆ°çº¦ 20-30 è¡Œ
- `renderSubNavItems`ï¼šä» 86 è¡Œå‡å°‘åˆ°çº¦ 30-40 è¡Œ
- ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡
- æ–¹æ³•èŒè´£å•ä¸€ï¼Œä¾¿äºæµ‹è¯•å’Œè°ƒè¯•

